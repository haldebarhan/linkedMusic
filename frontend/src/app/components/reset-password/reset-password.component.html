<div class="reset-password-container">
  <div class="reset-password-card">
    <div class="logo-section">
      <h1>üéµ ZikMuzik</h1>
    </div>

    <div class="form-header">
      <h2>Nouveau mot de passe</h2>
      <p>Choisissez un mot de passe fort et s√©curis√©</p>
    </div>

    <!-- Message de succ√®s -->
    <div class="alert alert-success" *ngIf="successMessage">
      <i class="fas fa-check-circle"></i>
      {{ successMessage }}
    </div>

    <!-- Message d'erreur -->
    <div class="alert alert-danger" *ngIf="errorMessage">
      <i class="fas fa-exclamation-circle"></i>
      {{ errorMessage }}
    </div>

    <form [formGroup]="resetPasswordForm" (ngSubmit)="onSubmit()" *ngIf="token">
      <!-- Nouveau mot de passe -->
      <div class="form-group">
        <label for="password">Nouveau mot de passe</label>
        <div class="input-wrapper">
          <i class="fas fa-lock"></i>
          <input
            [type]="showPassword ? 'text' : 'password'"
            id="password"
            formControlName="password"
            placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
            [class.is-invalid]="password?.invalid && password?.touched"
          />
          <i
            class="fas toggle-password"
            [class.fa-eye]="!showPassword"
            [class.fa-eye-slash]="showPassword"
            (click)="togglePasswordVisibility()"
          ></i>
        </div>

        <!-- Indicateur de force du mot de passe -->
        <div class="password-strength" *ngIf="password?.value">
          <div class="strength-bar">
            <div
              class="strength-fill"
              [class.weak]="getPasswordStrength() === 'weak'"
              [class.medium]="getPasswordStrength() === 'medium'"
              [class.strong]="getPasswordStrength() === 'strong'"
            ></div>
          </div>
          <span class="strength-text">
            {{
              getPasswordStrength() === "weak"
                ? "Faible"
                : getPasswordStrength() === "medium"
                ? "Moyen"
                : "Fort"
            }}
          </span>
        </div>

        <div
          class="invalid-feedback"
          *ngIf="password?.invalid && password?.touched"
        >
          <span *ngIf="password?.errors?.['required']"
            >Le mot de passe est requis</span
          >
          <span *ngIf="password?.errors?.['minlength']"
            >Minimum 8 caract√®res</span
          >
          <span *ngIf="password?.errors?.['weakPassword']">
            Le mot de passe doit contenir : majuscule, minuscule, chiffre et
            caract√®re sp√©cial
          </span>
        </div>

        <div class="password-requirements">
          <p class="requirements-title">Le mot de passe doit contenir :</p>
          <ul>
            <li [class.valid]="password?.value?.length >= 8">
              <i
                class="fas"
                [class.fa-check-circle]="password?.value?.length >= 8"
                [class.fa-circle]="password?.value?.length < 8"
              ></i>
              Au moins 8 caract√®res
            </li>
            <li [class.valid]="hasUpperCase()">
              <i
                class="fas"
                [class.fa-check-circle]="hasUpperCase()"
                [class.fa-circle]="!hasUpperCase()"
              ></i>
              Une lettre majuscule
            </li>
            <li [class.valid]="hasLowerCase()">
              <i
                class="fas"
                [class.fa-check-circle]="hasLowerCase()"
                [class.fa-circle]="!hasLowerCase()"
              ></i>
              Une lettre minuscule
            </li>
            <li [class.valid]="hasNumeric()">
              <i
                class="fas"
                [class.fa-check-circle]="hasNumeric()"
                [class.fa-circle]="!hasNumeric()"
              ></i>
              Un chiffre
            </li>
            <li [class.valid]="hasSpecialChar()">
              <i
                class="fas"
                [class.fa-check-circle]="hasSpecialChar()"
                [class.fa-circle]="!hasSpecialChar()"
              ></i>
              {{ "Un caract√®re sp√©cial (!@#$%...)" }}
            </li>
          </ul>
        </div>
      </div>

      <!-- Confirmation mot de passe -->
      <div class="form-group">
        <label for="confirmPassword">Confirmer le mot de passe</label>
        <div class="input-wrapper">
          <i class="fas fa-lock"></i>
          <input
            [type]="showConfirmPassword ? 'text' : 'password'"
            id="confirmPassword"
            formControlName="confirmPassword"
            placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
            [class.is-invalid]="(confirmPassword?.invalid && confirmPassword?.touched) || 
                                (resetPasswordForm.errors?.['passwordMismatch'] && confirmPassword?.touched)"
          />
          <i
            class="fas toggle-password"
            [class.fa-eye]="!showConfirmPassword"
            [class.fa-eye-slash]="showConfirmPassword"
            (click)="toggleConfirmPasswordVisibility()"
          ></i>
        </div>
        <div
          class="invalid-feedback"
          *ngIf="(confirmPassword?.invalid && confirmPassword?.touched) || 
                    (resetPasswordForm.errors?.['passwordMismatch'] && confirmPassword?.touched)"
        >
          <span *ngIf="confirmPassword?.errors?.['required']"
            >La confirmation est requise</span
          >
          <span *ngIf="resetPasswordForm.errors?.['passwordMismatch']">
            Les mots de passe ne correspondent pas
          </span>
        </div>
      </div>

      <button
        type="submit"
        class="btn btn-primary btn-block"
        [disabled]="loading || resetPasswordForm.invalid"
      >
        <span *ngIf="!loading">R√©initialiser le mot de passe</span>
        <span *ngIf="loading">
          <i class="fas fa-sync fa-spin"></i>
          R√©initialisation...
        </span>
      </button>

      <div class="form-footer">
        <a (click)="goToLogin()" class="link">
          <i class="fas fa-arrow-left"></i>
          Retour √† la connexion
        </a>
      </div>
    </form>
  </div>
</div>
