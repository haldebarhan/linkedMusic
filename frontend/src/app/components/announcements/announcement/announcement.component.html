<div class="container-fluid py-3" [formGroup]="form">
  <!-- Fil d'ariane -->
  <nav aria-label="breadcrumb" class="mb-4 bg-light">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="#">Accueil</a></li>
      <li class="breadcrumb-item active" aria-current="page">
        {{ slug | titlecase }}
      </li>
    </ol>
  </nav>
  <!-- Entête simple -->
  <h1 class="h4 mb-3 text-capitalize">{{ getTheme(slug) }}</h1>

  <!-- Filtres -->
  <div class="bg-light rounded p-3 mb-4">
    <div class="row g-3 align-items-center">
      <!-- Service -->
      <div
        class="services-panel bg-dark rounded p-3 mb-3"
        *ngIf="servicesColumns?.length"
        [formGroup]="form"
      >
        <div class="d-flex flex-wrap gap-4">
          <!-- une colonne -->
          <div class="services-col" *ngFor="let col of servicesColumns">
            <button
              type="button"
              class="service-item"
              *ngFor="let s of col"
              [class.active]="form.value.serviceTypeId === s.id"
              (click)="toggleService(s.id)"
            >
              {{ s.name }}
            </button>
          </div>
        </div>
      </div>

      <!-- Localisation centrée sous les services -->
      <div class="d-flex justify-content-center my-3">
        <div class="location-bar">
          <!-- Icône : utilise FA si dispo, sinon active la ligne Bootstrap Icons -->
          <i class="fa-solid fa-location-dot"></i>
          <!-- <i class="bi bi-geo-alt-fill"></i> -->
          <select
            class="form-select location-select"
            formControlName="location"
          >
            <option [ngValue]="''">Monde entier</option>
            <option [ngValue]="'France'">France</option>
            <option [ngValue]="'Paris'">Paris</option>
            <option [ngValue]="'Lyon'">Lyon</option>
            <option [ngValue]="'Marseille'">Marseille</option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <!-- Résultats (desktop) -->
  <div class="d-none d-md-block">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <div class="text-muted">
        <strong>{{ metadata.total }}</strong> annonces – page
        <strong>{{ metadata.page }}</strong>
      </div>
      <div class="d-flex align-items-center">
        <span class="me-2">Tri :</span>
        <select
          class="form-select"
          style="width: auto"
          (change)="applyFilters(false)"
        >
          <option value="date">Date</option>
          <option>Localisation</option>
        </select>
      </div>
    </div>

    <div class="table-responsive">
      <table class="table table-light table-hover">
        <thead>
          <tr></tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of rows">
            <td>
              <div class="d-flex align-items-start">
                <img
                  src="https://placehold.co/400"
                  alt=""
                  class="me-3"
                  width="60"
                  height="60"
                />
                <div>
                  <a class="fw-semibold">{{ item.title }}</a>
                  <div class="text-muted small">
                    {{ query ? (item.description | truncate) : item.location }}
                  </div>
                </div>
              </div>
            </td>
            <td>{{ item.createdAt | date }}</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <div
      class="d-flex justify-content-center mt-3"
      *ngIf="metadata.totalPage > 1"
    >
      <button
        class="btn btn-outline-light me-2"
        [disabled]="metadata.page === 1"
        (click)="changePage(metadata.page - 1)"
      >
        Précédent
      </button>
      <ng-container *ngFor="let p of pages">
        <button
          class="btn"
          [ngClass]="{
            'btn-primary': p === metadata.page,
            'btn-outline-light': p !== metadata.page
          }"
          (click)="changePage(p)"
        >
          {{ p }}
        </button>
      </ng-container>
      <button
        class="btn btn-outline-light ms-2"
        [disabled]="metadata.page === metadata.totalPage"
        (click)="changePage(metadata.page + 1)"
      >
        Suivant
      </button>
    </div>
  </div>

  <!-- Mobile: liste simple -->
  <div class="d-block d-md-none">
    <div class="list-group">
      <a
        href="#"
        class="list-group-item list-group-item-action d-flex align-items-start"
        *ngFor="let item of rows"
      >
        <img
          src="https://placehold.co/400"
          class="rounded me-2"
          width="60"
          height="60"
          alt="Annonce"
        />
        <div>
          <div class="fw-bold">
            {{ item.title }}
            <span class="badge bg-success" *ngIf="item.isHighlighted">PRO</span>
          </div>
          <div class="text-muted small">
            {{ item.description | slice : 0 : 40 }}
          </div>
          <div class="small">
            {{ item.location }} • {{ item.createdAt | date }}
          </div>
        </div>
      </a>
    </div>

    <!-- Loader -->
    <div class="text-center my-3">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Chargement...</span>
      </div>
    </div>

    <!-- Bouton retour en haut -->
    <button
      class="btn btn-primary rounded-circle shadow position-fixed back-to-top"
      (click)="scrollToTop()"
    >
      ↑
    </button>
  </div>
</div>
